<div class="header">
  <div style="display: flex;">
    <div style="display: flex; width: 100%;justify-content: flex-end;">
      <div class="IconBg" style="margin-left: 15px;" (click)="addReportTestData(tableCount)">
        <div>產報表</div>
      </div>
    </div>
  </div>

  <div class="CloseBtn" (click)="onCancel()">
    <ng-container>
      <mat-icon>clear</mat-icon>
    </ng-container>
  </div>
</div>
<div class="Windows">
  <div class="WindwsDiv">
    <mat-stepper orientation="vertical" [linear]="isLinear" #stepper (selectionChange)="selectionChange($event)">
      <mat-step [stepControl]="firstFormGroup">
        <form [formGroup]="firstFormGroup">
          <ng-template matStepLabel>請選擇報表時間</ng-template>
          <table class='table' style="width: 100%;align-items: center;border-collapse: collapse;border-color: #111111;">
            <tr class='tr_th_1 str_center'>
              <th class="th_1" style="width: 5%;border-right: 3px #000000 solid;" >
                <mat-checkbox color="primary" (change)="onCheckAll($event,firstFormGroup.controls.dataList)"></mat-checkbox></th>
              <th class="th_1" style="width: 25%;">報表內容</th>
              <th class="th_1">時間區間</th>
            </tr>
            <ng-container formArrayName="dataList">
              <ng-container *ngFor="let d of firstFormGroup.controls.dataList.controls; let index = index">
                <ng-container [formGroupName]="index">
                  <tr class="tr_td_2 str_center">
                    <td class="td_2">
                      <mat-checkbox color="primary" formControlName="sta" (ngModelChange)="onCheckExport($event,d)"></mat-checkbox>
                    </td>
                    <td class="td_2">{{d.value.reportName}}</td>
                    <td class="td_2">
                      <mat-form-field class="timeInputOut" *ngIf="d.value.sta == true">
                        <mat-date-range-input [rangePicker]="picker" >
                          <input matStartDate placeholder="起"  formControlName="SD">
                          <input matEndDate placeholder="迄" formControlName="ED">
                        </mat-date-range-input>
                        <mat-error>請填寫時間</mat-error>
                        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-date-range-picker #picker></mat-date-range-picker>
                      </mat-form-field>
                    </td>
                  </tr>
                </ng-container>
              </ng-container>
            </ng-container>
          </table>
          <div style="float: right;padding-top: 10px;">
            <button mat-button matStepperNext style="background-color: #fafafa;border: solid 1px #808080;">下一步</button>
          </div>
        </form>
      </mat-step>
      <mat-step>
        <mat-progress-spinner  mode="indeterminate"></mat-progress-spinner >
        <form>
          <ng-template matStepLabel>報表產生</ng-template>
          <div style="margin:0px auto;">
            <form #tableList>
              <ng-container *ngFor="let tableList of TestData">
                <div class="table_center90">
                  <div style="display: flex;justify-content: space-between;">
                    <div class="topTitle">{{tableList.title}}</div>
                    <div style="display: flex;" *ngIf="isIcon == true">
                      <div class="ExcelIcon"></div>
                      <div class="PdfIcon"></div>
                      <div class="deleteIcon"></div>
                    </div>
                  </div>
                  <table id="{{tableList.tableID}}" class='table'
                    style="width: 100%;align-items: center;border-collapse: collapse;border-color: #111111;">
                    <tr class='tr_th_1 str_center'>
                      <ng-container *ngFor="let thD of tableList.colNameList">
                        <th [width]="thD.width" class="th_1">{{thD.colName}}</th>
                      </ng-container>
                    </tr>
                    <ng-container *ngFor="let trList of tableList.tableList">
                      <tr class="tr_td_2 str_center">
                        <ng-container *ngFor="let td of trList.tdList">
                          <td class="td_1">{{td.data}}</td>
                        </ng-container>
                      </tr>
                    </ng-container>
                    <tr class='tr_th_1 str_center'>
                      <ng-container *ngFor="let footD of tableList.footerList">
                        <th class="th_2">{{footD.data}}</th>
                      </ng-container>
                    </tr>
                  </table>
                </div>
              </ng-container>
            </form>
          </div>
          <div>
            <button mat-button matStepperPrevious>上一步</button>
            <button mat-button [matMenuTriggerFor]="menu" class="downBtn">
              <mat-icon>download</mat-icon>
              下載
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="exportExcel()">
                <mat-icon>save</mat-icon>
                EXCEL
              </button>
              <button mat-menu-item (click)="exportPDF()">
                <mat-icon>picture_as_pdf</mat-icon>
                PDF
              </button>
            </mat-menu>
          </div>
        </form>
      </mat-step>
    </mat-stepper>
    <!--
    <div class="footer">
      <button class="Btn" (click)="onCancel()">
        取消
      </button>
    </div> -->
  </div>
</div>
